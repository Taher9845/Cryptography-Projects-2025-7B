<!DOCTYPE html>
<html>
<head>
    <title>Image Steganography (Colorful)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to right, #89f7fe, #66a6ff);
            color: #333;
            text-align: center;
            padding: 30px;
        }
        h2, h3 {
            color: #fff;
            text-shadow: 1px 1px 2px #000;
        }
        input, textarea {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin: 5px 0;
            width: 300px;
        }
        button {
            background-color: #ff6b6b;
            color: #fff;
            border: none;
            padding: 10px 20px;
            margin-top: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
        }
        button:hover {
            background-color: #ff4757;
        }
        p#output {
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px #000;
            font-size: 18px;
        }
        .section {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            margin: 20px auto;
            border-radius: 15px;
            width: 400px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <h2>Image Steganography</h2>

    <div class="section">
        <h3>Embed Message</h3>
        <input type="file" id="coverImage" accept="image/*"><br>
        <textarea id="message" placeholder="Enter message" rows="4" cols="40"></textarea><br>
        <button onclick="embedMessage()">Embed & Download</button>
    </div>

    <div class="section">
        <h3>Extract Message</h3>
        <input type="file" id="stegoImage" accept="image/*"><br>
        <button onclick="extractMessage()">Extract Message</button>
        <p id="output"></p>
    </div>

    <script>
        function textToBinary(text) {
            return text.split('').map(c => c.charCodeAt(0).toString(2).padStart(8,'0')).join('');
        }

        function binaryToText(bin) {
            let result = '';
            for(let i=0;i<bin.length;i+=8){
                result += String.fromCharCode(parseInt(bin.substr(i,8),2));
            }
            return result;
        }

        function embedMessage() {
            const file = document.getElementById('coverImage').files[0];
            const message = document.getElementById('message').value;
            if(!file || !message){ alert('Select image and enter message'); return; }

            const reader = new FileReader();
            reader.onload = function(e){
                const img = new Image();
                img.onload = function(){
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img,0,0);
                    const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
                    const data = imgData.data;

                    const binMessage = textToBinary(message) + "00000000";
                    if(binMessage.length > data.length) { alert('Message too long!'); return; }

                    for(let i=0;i<binMessage.length;i++){
                        data[i*4] = (data[i*4] & 254) | parseInt(binMessage[i]);
                    }

                    ctx.putImageData(imgData,0,0);
                    const link = document.createElement('a');
                    link.download = 'stego.png';
                    link.href = canvas.toDataURL();
                    link.click();
                }
                img.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }

        function extractMessage(){
            const file = document.getElementById('stegoImage').files[0];
            if(!file){ alert('Select stego image'); return; }

            const reader = new FileReader();
            reader.onload = function(e){
                const img = new Image();
                img.onload = function(){
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img,0,0);
                    const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
                    const data = imgData.data;

                    let binMessage = '';
                    for(let i=0;i<data.length;i+=4){
                        binMessage += (data[i] & 1);
                    }

                    let chars = [];
                    for(let i=0;i<binMessage.length;i+=8){
                        let byte = binMessage.substr(i,8);
                        if(byte === '00000000') break;
                        chars.push(String.fromCharCode(parseInt(byte,2)));
                    }

                    document.getElementById('output').innerText = "Recovered Message: " + chars.join('');
                }
                img.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
